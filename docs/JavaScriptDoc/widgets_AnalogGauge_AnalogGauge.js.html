<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: widgets/AnalogGauge/AnalogGauge.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: widgets/AnalogGauge/AnalogGauge.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';
/**
 * This widget is a generic implementation of an Analog Gauge. 
 * All of the Spek Gauges simply use this widget by passing in the different parameters.
 * It is configured using the avaiLabel arguments.
 * All arguments that take degrees, considers zero degrees at 3 o'clock.
 * All sizes are in pixels relative to 480x480. 
 * If a gauge is resized, it will automatically adjust these values.
 * &lt;p>
 * Other values, the gauge needs, are sent by the SIM to control, minimum, maximum, states, and intervals for the major,minor.
 * &lt;p>
 * Example of how the Tachometer uses this:
 * &lt;p>&lt;b>
 * &lt;pre>
 *  &amp;lt;sra-analog-gauge
 *       class                          = "SIMRacingApps-Widget-AnalogGauge-Spek-Tachometer"
 *       data-sra-args-analog-gauge     = "Tachometer"
 *       data-sra-args-start-angle      = "60"
 *       data-sra-args-end-angle        = "10"
 *       data-sra-args-x-label1         = "400"
 *       data-sra-args-y-label1         = "325"
 *       data-sra-args-font-size-label1 = "25"
 *       data-sra-args-anchor-label1    = "end"
 *       data-sra-args-x-label2         = "400"
 *       data-sra-args-y-label2         = "350"
 *       data-sra-args-font-size-label2 = "20"
 *       data-sra-args-anchor-label2    = "end"
 *       data-sra-args-round-to         = "{{sraRoundTo}}"
 *       data-sra-args-show-value       = "{{sraShowValue}}"
 *       data-sra-args-interval         = "{{sraArgsInterval||sraInterval}}"
 *  &amp;gt;&amp;lt;/sra-analog-gauge&amp;gt;
 * &lt;/pre>&lt;/b>
 * &lt;img src="../widgets/AnalogGauge/Spek/Tachometer/icon.png" />
 * @ngdoc directive
 * @name sra-analog-gauge
 * @param {string} data-sra-args-analog-gauge The name of the gauge that the SIM will use to send the values from. 
 *                 See, &lt;a href="../JavaDoc/com/SIMRacingApps/Gauge.Type.html">Gauges&lt;/a>, for avaiLabel values. Defaults to "Generic".
 * @param {milliseconds} data-sra-args-interval The interval that this widget will update from the server. Default is 300.
 * @param {degrees}  data-sra-args-start-angle The starting angle where the first major tick mark is displayed. Defaults to 120.
 * @param {degrees}  data-sra-args-end-angle The ending angle where the last major tick mark is displayed. Defaults to 420.
 * @param {pixels} data-sra-args-ring-size The width of the outer ring. Defaults to 20.
 * @param {pixels} data-sra-args-button-size The width of the middle button. Defaults to 50.
 * @param {pixels} data-sra-args-major-size The length of the major tick mark. Defaults to 30.
 * @param {pixels} data-sra-args-major-buffer This distance from the outer ring where the major tick mark starts. Defaults to 3.
 * @param {pixels} data-sra-args-text-buffer The distance from the outer ring where the major text starts. Defaults to 30.
 * @param {pixels} data-sra-args-major-font-size The size of the major text's font. Defaults to 30.
 * @param {pixels} data-sra-args-minor-size The length of the minor tick mark. Defaults to 15.
 * @param {pixels} data-sra-args-minor-buffer The distance from the outer rung where the minor tick mark starts. Defaults to 7.
 * @param {pixels} data-sra-args-needle-buffer The distance where the end of the needle is from the outer ring. Defaults to 25.
 * @param {double} data-sra-args-round-to The value to round the digital display to before displaying it. Defaults to 1.
 *                 For example: 100 rounds the value 1234 to 1200, .01 rounds the value 1234.5678 to 1234.57.
 * @param {integer} data-sra-args-decimals The number of decimal places to show after the decimal point regardless of rounding. Defaults to 0.
 * @param {string} data-sra-args-label1 The text for the main label. Defaults to blank.
 * @param {pixels} data-sra-args-x-label1 The X coordinate of where to put the main label. Defaults to 240.
 * @param {pixels} data-sra-args-y-label1 The Y coordinate of where to put the main label. Defaults to 150.
 * @param {pixels} data-sra-args-font-size-label1 The font size of the main label. Defaults to 40.
 * @param {string} data-sra-args-anchor-label1 The anchor defines where the X/Y coordinates are in relation to the entire text. Values are "middle", "left", "right". Defaults to "middle".
 * @param {string} data-sra-args-label2 The text for the second label. Defaults to blank.
 * @param {pixels} data-sra-args-x-label2 The X coordinate of where to put the second label. Defaults to 240.
 * @param {pixels} data-sra-args-y-label2 The Y coordinate of where to put the second label. Defaults to 185.
 * @param {pixels} data-sra-args-font-size-label2 The font size of the second label. Defaults to 30.
 * @param {string} data-sra-args-anchor-label2 The anchor defines where the X/Y coordinates are in relation to the entire text. Values are "middle", "left", "right". Defaults to "middle".
 * @param {pixels} data-sra-args-x-value The X coordinate of where to put the digital value. Defaults to 240.
 * @param {pixels} data-sra-args-y-value The Y coordinate of where to put the digital value. Defaults to 330.
 * @param {pixels} data-sra-args-font-size-value The font size of the second label. Defaults to 50.
 * @param {pixels} data-sra-args-anchor-value The anchor defines where the X/Y coordinates are in relation to the entire text. Values are "middle", "left", "right". Defaults to "middle".
 * @param {string} data-sra-args-uom The unit of measure to display. Overrides what comes from the SIM. Defaults to blank, let the SIM decide.
 * @param {pixels} data-sra-args-x-uom The X coordinate of where to put the UOM. Defaults to 240.
 * @param {pixels} data-sra-args-y-uom The Y coordinate of where to put the UOM. Defaults to 370.
 * @param {pixels} data-sra-args-font-size-uom The font size of the UOM. Defaults to 30.
 * @param {string} data-sra-args-anchor-uom The anchor defines where the X/Y coordinates are in relation to the entire text. Values are "middle", "left", "right". Defaults to "middle".
 * @param {milliseconds} data-sra-args-flash-rate The rate that the gauge will flash when it reaches the CRITICAL State. Defaults to 300.
 * @param {boolean} data-sra-args-flash-on-critical The condition, true or false, to determine if the gauge should flash. Defaults to true.
 *                  This value can be overridden for all gauges in the URL using "FLASHONCRITICAL=false".
 * @param {boolean} data-sra-args-show-digital-value The condition, true or false, to turn the digital value on and off. The default is true.
 *                  This value can be override for all gauge in the URL using "SHOWDIGITALVALUE=false".
 * @param {boolean} data-sra-args-use-speedometer The condition, true or false, to get the Tachometer to use the speed to determine the states relating to pit road speed.
 *          Defaults to true. If set to false, it uses the RPMs while in 2nd Gear that the SIM returns. 
 *          if your app or widget implements a way for the user to set it (like in the real stock cars), 
 *          then calling "/SIMRacingApps/Data/Car/REFERENCE/setRPMPitRoadSpeed/{RPM}" will set it for that session. 
 *          Otherwise, it will use the default from Car.json or the car specific json files for each SIM where it can be defined by track. 
 *          (NOTE: As of version 1.0, the json files have not been updated and the default is 3950.)
 * @author Jeffrey Gilliam
 * @since 1.0
 * @copyright Copyright (C) 2015 - 2016 Jeffrey Gilliam
 * @license Apache License 2.0
 */
define(['SIMRacingApps','css!widgets/AnalogGauge/AnalogGauge'],
function(SIMRacingApps) {

    var self = {
        name:            "sraAnalogGauge",
        url:             'AnalogGauge',
        template:        'AnalogGauge.html',
        defaultWidth:    480,
        defaultHeight:   480,
        defaultInterval: 300   //initialize with the default interval
    };

    self.module = angular.module('SIMRacingApps'); //get the main module

    self.module.directive(self.name,
           ['sraDispatcher', '$filter', '$location', '$interval', '$rootScope',
    function(sraDispatcher,  $filter,   $location,    $interval,   $rootScope) {
        return {
            restrict: 'EA',
            scope: true,
            templateUrl: sraDispatcher.getWidgetUrl(self.url) + '/' + self.template,
            controller: [ '$scope', function($scope) {
                $scope.directiveName   = self.name;
                $scope.defaultWidth    = self.defaultWidth;
                $scope.defaultHeight   = self.defaultHeight;
                $scope.defaultInterval = self.defaultInterval;

                $scope.majorMaxText = 3;
                $scope.majorScale  = [
                        { angle: 120, text: '0' },
                        { angle: 150, text: '10' },
                        { angle: 180, text: '20' },
                        { angle: 210, text: '30' },
                        { angle: 240, text: '40' },
                        { angle: 270, text: '50' },
                        { angle: 300, text: '60' },
                        { angle: 330, text: '70' },
                        { angle: 360, text: '80' },
                        { angle: 390, text: '90' },
                        { angle: 420, text: '100' }
                ];
                $scope.minorScale     = [];
                $scope.stateClass     = 'SIMRacingApps-Widget-AnalogGauge-state-OFF';
                $scope.revLights      = [];
                $scope.revLightBlinkState  = false;
                $scope.revLightAngles = [];
                $scope.revLightClasses= [];
                $scope.needleAngle    = 0;
                $scope.shiftFlashRate = 100;

                $scope.buildScales = function() {
                    var Minimum        = $scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].Minimum[$scope.argsUOM].Value        || 0;
                    var Maximum        = $scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].Maximum[$scope.argsUOM].Value        || 100;
                    var MajorIncrement = $scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].MajorIncrement[$scope.argsUOM].Value || 10;
                    var MinorIncrement = $scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].MinorIncrement[$scope.argsUOM].Value || 10;

                    if (Minimum !== "" &amp;&amp; Maximum !== "" &amp;&amp; MajorIncrement !== "") {
                        //console.log('AnalogGauge.buildScales.major('+Minimum+','+Maximum+','+MajorIncrement+')');
                        $scope.majorScale  = [];

                        var angle = $scope.startAngle;
                        var inc   = ($scope.endAngle - $scope.startAngle) / ((Maximum - Minimum) / MajorIncrement);
                        for (var min = Minimum; min &lt;= Maximum; min += MajorIncrement) {
                            $scope.majorScale.push({angle: angle, text: Math.floor(min)});
                            angle += inc;
                        }
                    }

                    if (Minimum !== "" &amp;&amp; Maximum !== "" &amp;&amp; MinorIncrement !== "") {
                        //console.log('AnalogGauge.buildScales.minor('+Minimum+','+Maximum+','+MinorIncrement+')');
                        $scope.minorScale  = [];

                        var angle = $scope.startAngle;
                        var inc   = ($scope.endAngle - $scope.startAngle) / ((Maximum - Minimum) / MinorIncrement);
                        for (var min = Minimum; min &lt;= Maximum; min += MinorIncrement) {
                            $scope.minorScale.push(angle);
                            angle += inc;
                        }
                    }
                };

                $scope.moveNeedle = function() {
                    var Minimum        = $scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].Minimum[$scope.argsUOM].Value         || 0;
                    var Maximum        = $scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].Maximum[$scope.argsUOM].Value         || 100;
                    var value          = $scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].ValueCurrent[$scope.argsUOM].Value    || 0;
                    var uom            = $scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].ValueCurrent[$scope.argsUOM].UOMAbbr  || "";

                    var range          = ($scope.endAngle - $scope.startAngle);

                    var v = value * ($scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].Multiplier.Value || 1.0);

                    if (v &lt;= Minimum)
                        $scope.needleAngle = $scope.startAngle;
                    else
                    if (v >= Maximum)
                        $scope.needleAngle = $scope.endAngle;
                    else {
                        var percentage = (v - Minimum) / (Maximum - Minimum);
                        $scope.needleAngle = $scope.startAngle + (percentage * range);
                    }

                    $scope.value = $filter('number')(Math.floor((value+($scope.roundTo/2))/$scope.roundTo) * $scope.roundTo,$scope.decimals);
                    $scope.value = $scope.value.toString().replace($scope.thousandsSeparator,'');
                    $scope.uom   = uom.toUpperCase();
                };

                $scope.updateLabels = function() {
                    $scope.Label1 = $scope.sraArgsLabel1 || $scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].Name.ValueFormatted;
                    $scope.Label2 = $scope.sraArgsLabel2 || $scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].TypeName.ValueFormatted;
                };

                $scope.updateColor = function() {
                    var state = $scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].ValueCurrent[$scope.argsUOM].State || "OFF";

                    var speedstate = $scope.data.Car.REFERENCE.Gauge.Speedometer.ValueCurrent.State || "OFF";
                    
//state = "CRITICAL";
                    //stop the blinking if we are not in the critical state.
                    if (!sraDispatcher.State.isCRITICAL(state) &amp;&amp; $scope._blink) {
                        $interval.cancel($scope._blink);
                        $scope._blink = null;
                    }

                    if (sraDispatcher.State.isCRITICAL(state) &amp;&amp; $scope.flashOnCritical) {
                        if ($scope._blink == null) {
                            $scope._blink = $interval(function() {
                                if ($scope.stateClass != 'SIMRacingApps-Widget-AnalogGauge-state-CRITICAL') {
                                    $scope.stateClass = 'SIMRacingApps-Widget-AnalogGauge-state-CRITICAL';
                                }
                                else {
                                    $scope.stateClass = 'SIMRacingApps-Widget-AnalogGauge-state-NORMAL';
                                }
                            }, $scope.flashRate);
                        }
                        else {
                            $scope.stateClass  = 'SIMRacingApps-Widget-AnalogGauge-state-'+state;
                        }
                    }
                    else
                    if (  $scope.useSpeedometer
                    &amp;&amp; (  sraDispatcher.State.isLIMIT(speedstate)
                       || sraDispatcher.State.isAPPROACHINGLIMIT(speedstate)
                       || sraDispatcher.State.isOVERLIMIT(speedstate)
                       || sraDispatcher.State.isWAYOVERLIMIT(speedstate)
                       )
                    &amp;&amp; !(  sraDispatcher.State.isSHIFT(state)
                        || sraDispatcher.State.isSHIFTBLINK(state)
                        || sraDispatcher.State.isCRITICAL(state)
                        )
                    ) {
                        $scope.stateClass  = 'SIMRacingApps-Widget-AnalogGauge-state-'+speedstate;
                    }
                    else
                    if (  $scope.useSpeedometer
                    &amp;&amp; (  sraDispatcher.State.isLIMIT(state)
                       || sraDispatcher.State.isAPPROACHINGLIMIT(state)
                       || sraDispatcher.State.isOVERLIMIT(state)
                       || sraDispatcher.State.isWAYOVERLIMIT(state)
                       )
                    ) {
                        $scope.stateClass  = 'SIMRacingApps-Widget-AnalogGauge-state-NORMAL';
                    }
                    else {
                        $scope.stateClass  = 'SIMRacingApps-Widget-AnalogGauge-state-'+state;
                    }
                };

                $scope.updateRevLights = function () {
                    $scope.updateColor();
                    
                    if ($scope.revLights.length > 0) {
                        var state   = $scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].ValueCurrent[$scope.argsUOM].State || "OFF";
                        var percent = ($scope.data.Car.REFERENCE.Gauge[$scope.sraAnalogGauge].ValueCurrent[$scope.argsUOM].StatePercent || 0) / 100.0;
                        var cutoff;

                        if ($scope._revLightsBlink 
                        &amp;&amp; !(sraDispatcher.State.isSHIFTBLINK(state) || sraDispatcher.State.isCRITICAL(state))
                        ) {
                            $interval.cancel($scope._revLightsBlink);
                            $scope._revLightsBlink = null;
                        }
                        
                        if ($scope.useSpeedometer 
                        &amp;&amp; !sraDispatcher.State.isSHIFTLIGHTS(state)
                        &amp;&amp; !sraDispatcher.State.isSHIFT(state)
                        &amp;&amp; !sraDispatcher.State.isSHIFTBLINK(state)
                        &amp;&amp; !sraDispatcher.State.isCRITICAL(state)
                        ) {
                            state   = $scope.data.Car.REFERENCE.Gauge.Speedometer.ValueCurrent.State || "OFF";
                            percent = ($scope.data.Car.REFERENCE.Gauge.Speedometer.ValueCurrent.StatePercent || 0) / 100.0;
                        }
                        
                        for (var revLight=0; revLight &lt; 7; revLight++) {
                            $scope.revLightClasses[revLight] = 'SIMRacingApps-Widget-AnalogGauge-state-OFF';

                            if (sraDispatcher.State.isAPPROACHINGLIMIT(state)) {
                                if (percent &lt;= (2/3)) {
                                    cutoff = ((1/8) * (2/3)) * (revLight+1);
                                    if (percent > cutoff) {
                                        $scope.revLightClasses[revLight] = 'SIMRacingApps-Widget-AnalogGauge-state-APPROACHINGLIMIT';
                                    }
                                }
                                else {
                                    cutoff = (2/3) + (((1/7) * (1/3)) * (revLight));
                                    if (percent > cutoff) {
                                        $scope.revLightClasses[revLight] = 'SIMRacingApps-Widget-AnalogGauge-state-LIMIT';
                                    }
                                }
                            }
                            else
                            if (sraDispatcher.State.isLIMIT(state) ) {
                                cutoff = (1/8) * (revLight+1);
                                if (percent > cutoff) {
                                    $scope.revLightClasses[revLight] = 'SIMRacingApps-Widget-AnalogGauge-state-OVERLIMIT';
                                }
                            }
                            else
                            if (sraDispatcher.State.isOVERLIMIT(state)) {
                                $scope.revLightClasses[revLight] = 'SIMRacingApps-Widget-AnalogGauge-state-OVERLIMIT';
                            }
                            else
                            if (sraDispatcher.State.isSHIFTLIGHTS(state)) { 
                                if (percent >= (revLight/7)) {
                                    if (revLight >= 0 &amp;&amp; revLight &lt;= 2)
                                        $scope.revLightClasses[revLight] = 'SIMRacingApps-Widget-AnalogGauge-ShiftLights-start';
                                    else
                                    if (revLight >= 3 &amp;&amp; revLight &lt;= 4)
                                        $scope.revLightClasses[revLight] = 'SIMRacingApps-Widget-AnalogGauge-ShiftLights-middle';
                                    else
                                        $scope.revLightClasses[revLight] = 'SIMRacingApps-Widget-AnalogGauge-ShiftLights-end';
                                }
                            }
                            else
                            if (sraDispatcher.State.isSHIFT(state) 
                            ||  sraDispatcher.State.isSHIFTBLINK(state) 
                            ||  sraDispatcher.State.isCRITICAL(state)
                            ) {
                                $scope.revLightClasses[revLight] = 'SIMRacingApps-Widget-AnalogGauge-ShiftLights-end';
                            }
                        }
                        
                        if (sraDispatcher.State.isSHIFTBLINK(state) || sraDispatcher.State.isCRITICAL(state)) {
                            if ($scope._revLightsBlink == null) {
                                $scope.revLightBlinkState = false;
                                
                                $scope._revLightsBlink = $interval(function() {
                                    
                                    for (var revLight=0; revLight &lt; 7; revLight++) {
                                        if ($scope.revLightBlinkState) {
                                            $scope.revLightClasses[revLight]  = 'SIMRacingApps-Widget-AnalogGauge-state-OFF';
                                        }
                                        else {
                                            $scope.revLightClasses[revLight] = 'SIMRacingApps-Widget-AnalogGauge-ShiftLights-end';
                                        }
                                    }
                                    $scope.revLightBlinkState = !$scope.revLightBlinkState;
                                    
                                }, $scope.shiftFlashRate);
                            }
                        }

                    }
                };

            }]
            , link: function($scope,$element,$attrs) {
                //copy arguments to our $scope
                $scope.value = 
                $scope[self.name]     = sraDispatcher.getTruthy($scope.sraArgsVALUE, $attrs[self.name], $attrs.sraArgsValue, "Generic");
                //$scope.sraAnalogGauge = $attrs.sraAnalogGauge             || $attrs.sraArgsValue || "Generic";
                $scope.startAngle     = $attrs.sraArgsStartAngle      * 1 || 120;
                $scope.endAngle       = $attrs.sraArgsEndAngle        * 1 || 420;
                $scope.ringSize       = $attrs.sraArgsRingSize        * 1 || 20;
                $scope.buttonSize     = $attrs.sraArgsButtonSize      * 1 || 50;
                $scope.majorSize      = $attrs.sraArgsMajorSize       * 1 || 30;
                $scope.majorBuffer    = $attrs.sraArgsMajorBuffer     * 1 || 3;
                $scope.majorTextBuffer= $attrs.sraArgsMajorTextBuffer * 1 || 30;
                $scope.majorFontSize  = $attrs.sraArgsMajorFontSize   * 1 || 30;
                $scope.minorSize      = $attrs.sraArgsMinorSize       * 1 || 15;
                $scope.minorBuffer    = $attrs.sraArgsMinorBuffer     * 1 || 7;
                $scope.needleBuffer   = $attrs.sraArgsNeedleBuffer    * 1 || 25;
                $scope.roundTo        = $attrs.sraArgsRoundTo         * 1 || 1;
                $scope.decimals       = $attrs.sraArgsDecimals        * 1 || 0;
                $scope.thousandsSeparator = $filter('number')(1000.1,1).toString().substr(1,1);

                $scope.sraArgsLabel1  = $attrs.sraArgsLabel1;
                $scope.xLabel1        = $attrs.sraArgsXLabel1         * 1 || 240;
                $scope.yLabel1        = $attrs.sraArgsYLabel1         * 1 || 150;
                $scope.fontSizeLabel1 = $attrs.sraArgsFontSizeLabel1  * 1 || 40;
                $scope.anchorLabel1   = $attrs.sraArgsAnchorLabel1        || 'middle';

                $scope.sraArgsLabel2  = $attrs.sraArgsLabel2;
                $scope.xLabel2        = $attrs.sraArgsXLabel2         * 1 || 240;
                $scope.yLabel2        = $attrs.sraArgsYLabel2         * 1 || 185;
                $scope.fontSizeLabel2 = $attrs.sraArgsFontSizeLabel2  * 1 || 30;
                $scope.anchorLabel2   = $attrs.sraArgsAnchorLabel2        || 'middle';

                $scope.xValue         = $attrs.sraArgsXValue          * 1 || 240;
                $scope.yValue         = $attrs.sraArgsYValue          * 1 || 330;
                $scope.fontSizeValue  = $attrs.sraArgsFontSizeValue   * 1 || 50;
                $scope.anchorValue    = $attrs.sraArgsAnchorValue         || 'middle';

                $scope.argsUOM        = $attrs.sraArgsUom                 || "";
                $scope.xUom           = $attrs.sraArgsXUom            * 1 || 240;
                $scope.yUom           = $attrs.sraArgsYUom            * 1 || 370;
                $scope.fontSizeUom    = $attrs.sraArgsFontSizeUom     * 1 || 30;
                $scope.anchorUom      = $attrs.sraArgsAnchorUom           || 'middle';

                $scope.flashRate      = $attrs.sraArgsFlashRate       * 1 || 300;
                $scope.flashOnCritical= sraDispatcher.getBoolean($attrs.sraArgsFlashOnCritical, true);

                //these arguments can be overridden from the url
                $scope.showValue      = sraDispatcher.getBoolean($scope.sraArgsSHOWDIGITALVALUE, $attrs.sraArgsShowDigitalValue, $attrs.sraArgsShowValue, true);
                $scope.useSpeedometer = $scope.sraAnalogGauge.toUpperCase() == "TACHOMETER"
                                      ? sraDispatcher.getBoolean($scope.sraArgsTACHUSESPEEDOMETER, $attrs.sraArgsUseSpeedometer, true)
                                      : false;

                while ($scope.endAngle &lt; $scope.startAngle)
                    $scope.endAngle += 360;

                $attrs.sraArgsData =
                              ($attrs.sraArgsData ? $attrs.sraArgsData + ";" : "")
                              + "Car/REFERENCE/Gauge/"+$scope.sraAnalogGauge+"/ValueCurrent/"+$scope.argsUOM
                              + ";Car/REFERENCE/Gauge/"+$scope.sraAnalogGauge+"/Minimum/"+$scope.argsUOM
                              + ";Car/REFERENCE/Gauge/"+$scope.sraAnalogGauge+"/Maximum/"+$scope.argsUOM
                              + ";Car/REFERENCE/Gauge/"+$scope.sraAnalogGauge+"/Multiplier"
                              + ";Car/REFERENCE/Gauge/"+$scope.sraAnalogGauge+"/MajorIncrement/"+$scope.argsUOM
                              + ";Car/REFERENCE/Gauge/"+$scope.sraAnalogGauge+"/MinorIncrement/"+$scope.argsUOM
                              + ";Car/REFERENCE/Gauge/"+$scope.sraAnalogGauge+"/Name"
                              + ";Car/REFERENCE/Gauge/"+$scope.sraAnalogGauge+"/TypeName"
                              + ";Car/REFERENCE/Gauge/Speedometer/ValueCurrent";
                ;

                $attrs.sraUOM    = $scope.uom;

                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].Minimum['"+$scope.argsUOM+"'].Value",             $scope.buildScales);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].Minimum['"+$scope.argsUOM+"'].UOM",               $scope.buildScales);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].Maximum['"+$scope.argsUOM+"'].Value",             $scope.buildScales);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].Maximum['"+$scope.argsUOM+"'].UOM",               $scope.buildScales);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].Multiplier.Value",                                $scope.buildScales);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].MajorIncrement['"+$scope.argsUOM+"'].Value",      $scope.buildScales);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].MajorIncrement['"+$scope.argsUOM+"'].UOM",        $scope.buildScales);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].MinorIncrement['"+$scope.argsUOM+"'].Value",      $scope.buildScales);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].MinorIncrement['"+$scope.argsUOM+"'].UOM",        $scope.buildScales);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].ValueCurrent['"+$scope.argsUOM+"'].Value",        $scope.moveNeedle);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].ValueCurrent['"+$scope.argsUOM+"'].UOM",          $scope.moveNeedle);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].Name.Value",                                      $scope.updateLabels);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].TypeName.Value",                                  $scope.updateLabels);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].ValueCurrent['"+$scope.argsUOM+"'].State",        $scope.updateColor);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].ValueCurrent['"+$scope.argsUOM+"'].State",        $scope.updateRevLights);
                $scope.$watch("data.Car.REFERENCE.Gauge['"+$scope.sraAnalogGauge+"'].ValueCurrent['"+$scope.argsUOM+"'].StatePercent", $scope.updateRevLights);
                $scope.$watch("data.Car.REFERENCE.Gauge.Speedometer.ValueCurrent.State",                                               $scope.updateColor);
                $scope.$watch("data.Car.REFERENCE.Gauge.Speedometer.ValueCurrent.State",                                               $scope.updateRevLights);
                $scope.$watch("data.Car.REFERENCE.Gauge.Speedometer.ValueCurrent.StatePercent",                                        $scope.updateRevLights);
                
                if ($scope.sraAnalogGauge.toUpperCase() == "TACHOMETER") {
                    for (var revLight=0; revLight &lt; 7; revLight++) {
                        $scope.revLights.push(revLight);
                        $scope.revLightClasses.push('SIMRacingApps-Widget-AnalogGauge-state-OFF');
                        $scope.revLightAngles.push((revLight*25)+195);  //make 270 is in the middle
                    }
                }

                $rootScope.$on('sraResize', sraDispatcher.resize($scope,$element,self.defaultWidth,self.defaultHeight));

           /**standard code that should be in every directive **/
                $scope.names        = sraDispatcher.subscribe($scope,$attrs,self.defaultInterval); //register subscriptions and options to the dispatcher

            }
        };
    }]);

    return self;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-SIMRacingApps.html">SIMRacingApps</a></li></ul><h3>apps</h3><ul><li><a href="CrewChief.html">CrewChief</a></li><li><a href="CrewChief-Large.html">CrewChief-Large</a></li><li><a href="Dash-BarGauges-DigitalOverlay.html">Dash-BarGauges-DigitalOverlay</a></li><li><a href="Dash-Gauges-Spek.html">Dash-Gauges-Spek</a></li><li><a href="Dash-Gauges-Spek-Horizontal.html">Dash-Gauges-Spek-Horizontal</a></li><li><a href="Dash-Minimum.html">Dash-Minimum</a></li><li><a href="Dash-Small.html">Dash-Small</a></li><li><a href="Dash-StockCars-DigitalOverlay.html">Dash-StockCars-DigitalOverlay</a></li><li><a href="RaceAdministrator.html">RaceAdministrator</a></li><li><a href="Spectator.html">Spectator</a></li><li><a href="StreamingOverlay.html">StreamingOverlay</a></li></ul><h3>filter</h3><ul><li><a href="module-SIMRacingApps.sraCeil.html">sraCeil</a></li><li><a href="module-SIMRacingApps.sraDebug.html">sraDebug</a></li><li><a href="module-SIMRacingApps.sraDecodeEntities.html">sraDecodeEntities</a></li><li><a href="module-SIMRacingApps.sraDuration.html">sraDuration</a></li><li><a href="module-SIMRacingApps.sraFloor.html">sraFloor</a></li><li><a href="module-SIMRacingApps.sraHex.html">sraHex</a></li><li><a href="module-SIMRacingApps.sraLPad.html">sraLPad</a></li><li><a href="module-SIMRacingApps.sraNumber.html">sraNumber</a></li><li><a href="module-SIMRacingApps.sraRGB.html">sraRGB</a></li><li><a href="module-SIMRacingApps.sraRound.html">sraRound</a></li><li><a href="module-SIMRacingApps.sraRPad.html">sraRPad</a></li></ul><h3>directive</h3><ul><li><a href="module-SIMRacingApps-sra-data.html">sra-data</a></li><li><a href="module-SIMRacingApps-sra-horizontal-align.html">sra-horizontal-align</a></li><li><a href="module-SIMRacingApps-sra-resize.html">sra-resize</a></li><li><a href="module-SIMRacingApps-sra-vertical-align.html">sra-vertical-align</a></li><li><a href="sra-analog-gauge.html">sra-analog-gauge</a></li><li><a href="sra-analog-gauge-spek-brake-pressure.html">sra-analog-gauge-spek-brake-pressure</a></li><li><a href="sra-analog-gauge-spek-fuel-level.html">sra-analog-gauge-spek-fuel-level</a></li><li><a href="sra-analog-gauge-spek-fuel-pressure.html">sra-analog-gauge-spek-fuel-pressure</a></li><li><a href="sra-analog-gauge-spek-oil-level.html">sra-analog-gauge-spek-oil-level</a></li><li><a href="sra-analog-gauge-spek-oil-pressure.html">sra-analog-gauge-spek-oil-pressure</a></li><li><a href="sra-analog-gauge-spek-oil-temp.html">sra-analog-gauge-spek-oil-temp</a></li><li><a href="sra-analog-gauge-spek-tachometer.html">sra-analog-gauge-spek-tachometer</a></li><li><a href="sra-analog-gauge-spek-voltage.html">sra-analog-gauge-spek-voltage</a></li><li><a href="sra-analog-gauge-spek-water-level.html">sra-analog-gauge-spek-water-level</a></li><li><a href="sra-analog-gauge-spek-water-pressure.html">sra-analog-gauge-spek-water-pressure</a></li><li><a href="sra-analog-gauge-spek-water-temp.html">sra-analog-gauge-spek-water-temp</a></li><li><a href="sra-bar-gauge.html">sra-bar-gauge</a></li><li><a href="sra-bar-gauge-brake-pressure.html">sra-bar-gauge-brake-pressure</a></li><li><a href="sra-bar-gauge-fuel-level.html">sra-bar-gauge-fuel-level</a></li><li><a href="sra-bar-gauge-fuel-pressure.html">sra-bar-gauge-fuel-pressure</a></li><li><a href="sra-bar-gauge-oil-level.html">sra-bar-gauge-oil-level</a></li><li><a href="sra-bar-gauge-oil-pressure.html">sra-bar-gauge-oil-pressure</a></li><li><a href="sra-bar-gauge-oil-temp.html">sra-bar-gauge-oil-temp</a></li><li><a href="sra-bar-gauge-tachometer.html">sra-bar-gauge-tachometer</a></li><li><a href="sra-bar-gauge-voltage.html">sra-bar-gauge-voltage</a></li><li><a href="sra-bar-gauge-water-level.html">sra-bar-gauge-water-level</a></li><li><a href="sra-bar-gauge-water-pressure.html">sra-bar-gauge-water-pressure</a></li><li><a href="sra-bar-gauge-water-temp.html">sra-bar-gauge-water-temp</a></li><li><a href="sra-car-controls.html">sra-car-controls</a></li><li><a href="sra-car-image.html">sra-car-image</a></li><li><a href="sra-car-number.html">sra-car-number</a></li><li><a href="sra-car-number-extended.html">sra-car-number-extended</a></li><li><a href="sra-car-selector.html">sra-car-selector</a></li><li><a href="sra-data-table.html">sra-data-table</a></li><li><a href="sra-driver-info.html">sra-driver-info</a></li><li><a href="sra-flags.html">sra-flags</a></li><li><a href="sra-fuel-tank.html">sra-fuel-tank</a></li><li><a href="sra-gear.html">sra-gear</a></li><li><a href="sra-lap-timing.html">sra-lap-timing</a></li><li><a href="sra-pedals.html">sra-pedals</a></li><li><a href="sra-pit-commander.html">sra-pit-commander</a></li><li><a href="sra-pit-road.html">sra-pit-road</a></li><li><a href="sra-radio-control.html">sra-radio-control</a></li><li><a href="sra-relative.html">sra-relative</a></li><li><a href="sra-relative-small.html">sra-relative-small</a></li><li><a href="sra-shift-light.html">sra-shift-light</a></li><li><a href="sra-shift-lights.html">sra-shift-lights</a></li><li><a href="sra-standings.html">sra-standings</a></li><li><a href="sra-standings-banner.html">sra-standings-banner</a></li><li><a href="sra-standings-top-10.html">sra-standings-top-10</a></li><li><a href="sra-standings-top-20.html">sra-standings-top-20</a></li><li><a href="sra-standings-top-35.html">sra-standings-top-35</a></li><li><a href="sra-standings-top-43.html">sra-standings-top-43</a></li><li><a href="sra-steering-wheel.html">sra-steering-wheel</a></li><li><a href="sra-team-speak-talking.html">sra-team-speak-talking</a></li><li><a href="sra-template.html">sra-template</a></li><li><a href="sra-timing-delta.html">sra-timing-delta</a></li><li><a href="sra-tire.html">sra-tire</a></li><li><a href="sra-tire-measurements.html">sra-tire-measurements</a></li><li><a href="sra-track-map.html">sra-track-map</a></li><li><a href="sra-track-map-car.html">sra-track-map-car</a></li><li><a href="sra-track-map-finish-line.html">sra-track-map-finish-line</a></li><li><a href="sra-weather-info.html">sra-weather-info</a></li><li><a href="sra-wind-gauge.html">sra-wind-gauge</a></li></ul><h3>controller</h3><ul><li><a href="module-SIMRacingApps-sraController.html">sraController</a></li></ul><h3>factory</h3><ul><li><a href="module-SIMRacingApps-sraDispatcher.html">sraDispatcher</a></li></ul><h3>Global</h3><ul><li><a href="global.html#SIMRacingAppsCache">SIMRacingAppsCache</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> 
    using <a href="https://github.com/allenhwkim/angular-jsdoc">Angular-JSDoc template </a> 
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
<script>
  // scroll to the current document navigation
  var href=window.location.href.match(/\/([^\/]+$)/)[1];
  if (currentNav = document.querySelector("nav a[href='"+href+"']"))
    currentNav.scrollIntoView(true);
  // scroll to the top of the document
  if (window.location.hash == "")
    document.querySelector("body").scrollIntoView(true);
  // adjust the width of main section by navigation width
  // var navWidth = document.querySelector('nav').getBoundingClientRect().width;
  // var mainWidth = document.querySelector('#main').getBoundingClientRect().width;
  // document.querySelector('#main').style.width = (mainWidth - navWidth)+'px';
</script>
</body>
</html>
