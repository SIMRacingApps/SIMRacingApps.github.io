<!doctype html>
<html>
  <head>
    <base href="../">
    <title>JSDoc: source : TimingDelta.js</title>
    <link type="text/css" rel="stylesheet" href="css/jsdoc-default.css">
    <link href="css/prettify-tomorrow.css" type="text/css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,400,300,700" rel="stylesheet" type="text/css">
    <link href="css/custom.css" type="text/css" rel="stylesheet">
    <script src="js/prettify.js"></script>
    <script src="js/angular.min.js"></script>
  </head>
  <body ng-app="">
    <nav>
      <h2><a href="index.html">Index</a></h2>
      <ul class="module">
        <!-- undefined -->
        <h3>
          <a href="" ng-click="moduleundefined = !moduleundefined">
            module: undefined
          </a>
          <i ng-cloak="" ng-show="moduleundefined">+</i>
        </h3>
        <li id="undefined" ng-hide="moduleundefined">
          <ul class="group">
            <h3>
              <a href="" ng-click="undefinedapps = !undefinedapps">
                apps
              </a>
              <i ng-cloak="" ng-show="undefinedapps">+</i>
            </h3>
            <ul ng-hide="undefinedapps">
              <li>
                <a href="CrewChief.html">CrewChief</a>
              </li><li>
                <a href="CrewChief-Large.html">CrewChief-Large</a>
              </li><li>
                <a href="Dash-BarGauges-DigitalOverlay.html">Dash-BarGauges-DigitalOverlay</a>
              </li><li>
                <a href="Dash-Gauges-Spek.html">Dash-Gauges-Spek</a>
              </li><li>
                <a href="Dash-Gauges-Spek-Horizontal.html">Dash-Gauges-Spek-Horizontal</a>
              </li><li>
                <a href="Dash-Minimum.html">Dash-Minimum</a>
              </li><li>
                <a href="Dash-Small.html">Dash-Small</a>
              </li><li>
                <a href="Dash-StockCars-DigitalOverlay.html">Dash-StockCars-DigitalOverlay</a>
              </li><li>
                <a href="RaceAdministrator.html">RaceAdministrator</a>
              </li><li>
                <a href="Spectator.html">Spectator</a>
              </li><li>
                <a href="StreamingOverlay.html">StreamingOverlay</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h3>
              <a href="" ng-click="undefineddirective = !undefineddirective">
                directive
              </a>
              <i ng-cloak="" ng-show="undefineddirective">+</i>
            </h3>
            <ul ng-hide="undefineddirective">
              <li>
                <a href="sra-analog-gauge.html">sra-analog-gauge</a>
              </li><li>
                <a href="sra-analog-gauge-spek-brake-pressure.html">sra-analog-gauge-spek-brake-pressure</a>
              </li><li>
                <a href="sra-analog-gauge-spek-fuel-level.html">sra-analog-gauge-spek-fuel-level</a>
              </li><li>
                <a href="sra-analog-gauge-spek-fuel-pressure.html">sra-analog-gauge-spek-fuel-pressure</a>
              </li><li>
                <a href="sra-analog-gauge-spek-oil-level.html">sra-analog-gauge-spek-oil-level</a>
              </li><li>
                <a href="sra-analog-gauge-spek-oil-pressure.html">sra-analog-gauge-spek-oil-pressure</a>
              </li><li>
                <a href="sra-analog-gauge-spek-oil-temp.html">sra-analog-gauge-spek-oil-temp</a>
              </li><li>
                <a href="sra-analog-gauge-spek-tachometer.html">sra-analog-gauge-spek-tachometer</a>
              </li><li>
                <a href="sra-analog-gauge-spek-voltage.html">sra-analog-gauge-spek-voltage</a>
              </li><li>
                <a href="sra-analog-gauge-spek-water-level.html">sra-analog-gauge-spek-water-level</a>
              </li><li>
                <a href="sra-analog-gauge-spek-water-pressure.html">sra-analog-gauge-spek-water-pressure</a>
              </li><li>
                <a href="sra-analog-gauge-spek-water-temp.html">sra-analog-gauge-spek-water-temp</a>
              </li><li>
                <a href="sra-bar-gauge.html">sra-bar-gauge</a>
              </li><li>
                <a href="sra-bar-gauge-brake-pressure.html">sra-bar-gauge-brake-pressure</a>
              </li><li>
                <a href="sra-bar-gauge-fuel-level.html">sra-bar-gauge-fuel-level</a>
              </li><li>
                <a href="sra-bar-gauge-fuel-pressure.html">sra-bar-gauge-fuel-pressure</a>
              </li><li>
                <a href="sra-bar-gauge-oil-level.html">sra-bar-gauge-oil-level</a>
              </li><li>
                <a href="sra-bar-gauge-oil-pressure.html">sra-bar-gauge-oil-pressure</a>
              </li><li>
                <a href="sra-bar-gauge-oil-temp.html">sra-bar-gauge-oil-temp</a>
              </li><li>
                <a href="sra-bar-gauge-tachometer.html">sra-bar-gauge-tachometer</a>
              </li><li>
                <a href="sra-bar-gauge-voltage.html">sra-bar-gauge-voltage</a>
              </li><li>
                <a href="sra-bar-gauge-water-level.html">sra-bar-gauge-water-level</a>
              </li><li>
                <a href="sra-bar-gauge-water-pressure.html">sra-bar-gauge-water-pressure</a>
              </li><li>
                <a href="sra-bar-gauge-water-temp.html">sra-bar-gauge-water-temp</a>
              </li><li>
                <a href="sra-car-controls.html">sra-car-controls</a>
              </li><li>
                <a href="sra-car-image.html">sra-car-image</a>
              </li><li>
                <a href="sra-car-number.html">sra-car-number</a>
              </li><li>
                <a href="sra-car-number-extended.html">sra-car-number-extended</a>
              </li><li>
                <a href="sra-car-selector.html">sra-car-selector</a>
              </li><li>
                <a href="sra-chat.html">sra-chat</a>
              </li><li>
                <a href="sra-data-table.html">sra-data-table</a>
              </li><li>
                <a href="sra-driver-info.html">sra-driver-info</a>
              </li><li>
                <a href="sra-flags.html">sra-flags</a>
              </li><li>
                <a href="sra-fuel-tank.html">sra-fuel-tank</a>
              </li><li>
                <a href="sra-gear.html">sra-gear</a>
              </li><li>
                <a href="sra-lap-timing.html">sra-lap-timing</a>
              </li><li>
                <a href="sra-laps-banner.html">sra-laps-banner</a>
              </li><li>
                <a href="sra-messages.html">sra-messages</a>
              </li><li>
                <a href="sra-pedals.html">sra-pedals</a>
              </li><li>
                <a href="sra-pit-commander.html">sra-pit-commander</a>
              </li><li>
                <a href="sra-pit-road.html">sra-pit-road</a>
              </li><li>
                <a href="sra-radio-control.html">sra-radio-control</a>
              </li><li>
                <a href="sra-relative.html">sra-relative</a>
              </li><li>
                <a href="sra-relative-small.html">sra-relative-small</a>
              </li><li>
                <a href="sra-shift-light.html">sra-shift-light</a>
              </li><li>
                <a href="sra-shift-lights.html">sra-shift-lights</a>
              </li><li>
                <a href="sra-standings.html">sra-standings</a>
              </li><li>
                <a href="sra-standings-banner.html">sra-standings-banner</a>
              </li><li>
                <a href="sra-standings-top-10.html">sra-standings-top-10</a>
              </li><li>
                <a href="sra-standings-top-20.html">sra-standings-top-20</a>
              </li><li>
                <a href="sra-standings-top-35.html">sra-standings-top-35</a>
              </li><li>
                <a href="sra-standings-top-43.html">sra-standings-top-43</a>
              </li><li>
                <a href="sra-steering-wheel.html">sra-steering-wheel</a>
              </li><li>
                <a href="sra-team-speak-talking.html">sra-team-speak-talking</a>
              </li><li>
                <a href="sra-template.html">sra-template</a>
              </li><li>
                <a href="sra-time.html">sra-time</a>
              </li><li>
                <a href="sra-timing-delta.html">sra-timing-delta</a>
              </li><li>
                <a href="sra-tire.html">sra-tire</a>
              </li><li>
                <a href="sra-tire-measurements.html">sra-tire-measurements</a>
              </li><li>
                <a href="sra-track-map.html">sra-track-map</a>
              </li><li>
                <a href="sra-track-map-car.html">sra-track-map-car</a>
              </li><li>
                <a href="sra-track-map-finish-line.html">sra-track-map-finish-line</a>
              </li><li>
                <a href="sra-weather-info.html">sra-weather-info</a>
              </li><li>
                <a href="sra-wind-gauge.html">sra-wind-gauge</a>
              </li>
            </ul>
          </ul>
        </li>
      </ul><ul class="module">
        <!-- module_____acing_pps -->
        <h3>
          <a href="" ng-click="modulemodule_____acing_pps = !modulemodule_____acing_pps">
            module: module:SIMRacingApps
          </a>
          <i ng-cloak="" ng-show="modulemodule_____acing_pps">+</i>
        </h3>
        <li id="module:SIMRacingApps" ng-hide="modulemodule_____acing_pps">
          <ul class="group">
            <h3>
              <a href="" ng-click="module_____acing_ppsfilter = !module_____acing_ppsfilter">
                filter
              </a>
              <i ng-cloak="" ng-show="module_____acing_ppsfilter">+</i>
            </h3>
            <ul ng-hide="module_____acing_ppsfilter">
              <li>
                <a href="module-SIMRacingApps.sraCeil.html">sraCeil</a>
              </li><li>
                <a href="module-SIMRacingApps.sraDebug.html">sraDebug</a>
              </li><li>
                <a href="module-SIMRacingApps.sraDecodeEntities.html">sraDecodeEntities</a>
              </li><li>
                <a href="module-SIMRacingApps.sraDuration.html">sraDuration</a>
              </li><li>
                <a href="module-SIMRacingApps.sraFloor.html">sraFloor</a>
              </li><li>
                <a href="module-SIMRacingApps.sraHex.html">sraHex</a>
              </li><li>
                <a href="module-SIMRacingApps.sraLPad.html">sraLPad</a>
              </li><li>
                <a href="module-SIMRacingApps.sraNumber.html">sraNumber</a>
              </li><li>
                <a href="module-SIMRacingApps.sraRGB.html">sraRGB</a>
              </li><li>
                <a href="module-SIMRacingApps.sraRound.html">sraRound</a>
              </li><li>
                <a href="module-SIMRacingApps.sraRPad.html">sraRPad</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h3>
              <a href="" ng-click="module_____acing_ppsdirective = !module_____acing_ppsdirective">
                directive
              </a>
              <i ng-cloak="" ng-show="module_____acing_ppsdirective">+</i>
            </h3>
            <ul ng-hide="module_____acing_ppsdirective">
              <li>
                <a href="module-SIMRacingApps-sra-data.html">sra-data</a>
              </li><li>
                <a href="module-SIMRacingApps-sra-horizontal-align.html">sra-horizontal-align</a>
              </li><li>
                <a href="module-SIMRacingApps-sra-resize.html">sra-resize</a>
              </li><li>
                <a href="module-SIMRacingApps-sra-vertical-align.html">sra-vertical-align</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h3>
              <a href="" ng-click="module_____acing_ppscontroller = !module_____acing_ppscontroller">
                controller
              </a>
              <i ng-cloak="" ng-show="module_____acing_ppscontroller">+</i>
            </h3>
            <ul ng-hide="module_____acing_ppscontroller">
              <li>
                <a href="module-SIMRacingApps-sraController.html">sraController</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h3>
              <a href="" ng-click="module_____acing_ppsfactory = !module_____acing_ppsfactory">
                factory
              </a>
              <i ng-cloak="" ng-show="module_____acing_ppsfactory">+</i>
            </h3>
            <ul ng-hide="module_____acing_ppsfactory">
              <li>
                <a href="module-SIMRacingApps-sraDispatcher.html">sraDispatcher</a>
              </li>
            </ul>
          </ul>
        </li>
      </ul>
    </nav>
    <div id="content" class="page-wrap">
      <h1 class="title">
        source : TimingDelta.js
      </h1>
      <div id="main" class="big-container">
        <!-- source code html -->
        <article>
          <pre class="prettyprint source linenums"><code>'use strict';/** * This widget displays the projected lap time based on a relative point in time. * If Green, then you are faster than the relative point, Red if not. * It also shows in different shades of Red and Green a projection of how you are doing to the relative point.  * Clicking on the widget, will rotate between the available relative points.  * &lt;p> * Example: * &lt;p>&lt;b> * &lt;sra-timing-delta&gt;&lt;/sra-timing-delta&gt;&lt;br /> * &lt;/b> * &lt;img src="../widgets/TimingDelta/icon.png" atl="Image goes here"/> * @ngdoc directive * @name sra-timing-delta * @param {String} data-sra-args-value Basis for the relative delta calculation. Defaults to SESSIONBEST.  *                 Must be one of the following: SESSIONBEST, SESSIONOPTIMAL, SESSIONLAST, BEST, OPTIMAL. * @param {integer} data-sra-args-interval The interval, in milliseconds, that this widget will update from the server. Default is 100. * @author Jeffrey Gilliam * @since 1.0 * @copyright Copyright (C) 2015 - 2016 Jeffrey Gilliam * @license Apache License 2.0 */define(['SIMRacingApps','css!widgets/TimingDelta/TimingDelta'],function(SIMRacingApps) {    var self = {        name:            "sraTimingDelta",        url:             'TimingDelta',        template:        'TimingDelta.html',        defaultWidth:    800,        defaultHeight:   480,        defaultInterval: 100   //initialize with the default interval    };    self.module = angular.module('SIMRacingApps'); //get the main module    self.module.directive(self.name,           ['sraDispatcher', '$filter', '$rootScope',    function(sraDispatcher,   $filter,   $rootScope) {        return {            restrict:    'EA',            scope:       true,            templateUrl: sraDispatcher.getWidgetUrl(self.url) + '/' + self.template,            controller: [ '$scope', function($scope) {                $scope.directiveName   = self.name;                $scope.defaultWidth    = self.defaultWidth;                $scope.defaultHeight   = self.defaultHeight;                $scope.defaultInterval = self.defaultInterval;                $scope.visibility      = "hidden";                //load translations, if you have any un-comment this                sraDispatcher.loadTranslations(sraDispatcher.getWidgetUrl(self.url),'text',function(path) {                    $scope.translations = sraDispatcher.getTranslation(path);                });                /** your code goes here **/                $scope.update = function() {                    var sessionBest      = $scope.data.Car.REFERENCE.LapTimeDeltaReference.SESSIONBEST.Value;                    var sessionBestDelta = $scope.data.Car.REFERENCE.LapTimeDelta.SESSIONBEST.Value;                    var delta            = $scope.data.Car.REFERENCE.LapTimeDelta[$scope.value].Value;                    var percent          = $scope.data.Car.REFERENCE.LapTimeDeltaPercent[$scope.value].Value;                    var reference        = $scope.data.Car.REFERENCE.LapTimeDeltaReference[$scope.value].Value;                    var category         = $scope.data.Track.Category.Value;                    $scope.visibility = $scope.data.Car.REFERENCE.LapTimeDelta[$scope.value].State == 'NORMAL'                                       ? 'inherit'                                      : 'hidden';                     //position the bar, adjust the width and set it's color                    var w,l;                    var color = 'white';                    var deltacolor = 'white';                    //iRacing only shows a smaller bar if the time is within +/- .5 second                    //so if not, setup for maximum bar                    //TODO: There are entries in the app.ini for the range. Should I read them?                    //      [SplitsDeltas]                    //      deltaBarRangeOval=0.5                    //      deltaBarRangeRoad=2.0                    var range = category == "Oval" ? .5 : 2.0;                    if (delta &lt; (range * -1)) {                        l = 50;                        w = 50;                        color = 'chartreuse';                    }                    else                    if (delta > range) {                        l = 0;                        w = 50;                        color = 'red';                    }                    else {                        w = (Math.abs(delta) / range) * 50;                        if (delta &lt; 0) {                            color = 'chartreuse';                            l = 50;                        }                        else                        if (delta > 0) {                            color = 'red';                            l = 50 - w;                        }                        else {                            color = 'white';                            l = 50;                        }                    }                    var invpct = (100.0 - Math.abs(percent)) / 100.0;                    // -1 to 0 to 1 = green(-1) to white(0), to red(1)                    if (percent >= -100 && percent &lt; 0) {                        deltacolor = (Math.round(255 * invpct) &lt;&lt; 16) + 0xFF00 + Math.round(255 * invpct);                    }                    else                    if (percent > 0 && percent &lt;= 100) {                        deltacolor = 0xFF0000 + (Math.round(255 * invpct) &lt;&lt; 8) + Math.round(255 * invpct);                    }                    else {                        deltacolor = 0xFFFFFF; /* white */                    }                    if ($scope.data.Car.REFERENCE.Lap.CompletedPercent.Value &lt; 15) {                        $scope.fontWeight = 'bold';                        //don't update the times to hold them steady for a little while                    }                    else {                        $scope.barWidth      = w;                        $scope.barLeft       = l;                        $scope.barDeltaColor = deltacolor;                        $scope.fontColor     = color;                        $scope.fontWeight = 'normal';                        //$scope.projected  = reference + delta;                        $scope.projected  = sessionBest + sessionBestDelta;                        $scope.delta      = delta;                    }                };                $scope.values = ['SESSIONBEST','SESSIONOPTIMAL','SESSIONLAST','BEST','OPTIMAL'];                $scope.onClick = function(event) {                    for (var i=0; $scope.value && i &lt; $scope.values.length; i++) {                        if ($scope.values[i] == $scope.value.toUpperCase()) {                            $scope.value = $scope.values[ ++i % $scope.values.length ];                            console.log("TimingDelta = "+$scope.value);                            return;                        }                    }                };            }]            , link: function($scope,$element,$attrs) {                //copy arguments to our scope. First if using attribute, second tag, else default to something.                $attrs.sraArgsData = $attrs.sraArgsData || "";                $scope.value =                 $scope[self.name] = sraDispatcher.getTruthy($scope.sraArgsVALUE, $attrs[self.name], $attrs.sraArgsValue, "SessionBest").toUpperCase();                /** your code goes here **/                for (var i=0; i &lt; $scope.values.length; i++) {                    $attrs.sraArgsData += ";Car/REFERENCE/LapTimeDelta/"+$scope.values[i];                    $attrs.sraArgsData += ";Car/REFERENCE/LapTimeDeltaPercent/"+$scope.values[i];                    $attrs.sraArgsData += ";Car/REFERENCE/LapTimeDeltaReference/"+$scope.values[i];                }                $attrs.sraArgsData += ";Car/REFERENCE/Lap/CompletedPercent";                $attrs.sraArgsData += ";Track/Category";                /**standard code that should be in every directive **/                $rootScope.$on('sraResize', sraDispatcher.resize($scope,$element,self.defaultWidth,self.defaultHeight));                //register with the dispatcher                $scope.names = sraDispatcher.subscribe($scope,$attrs,self.defaultInterval); //register subscriptions and options to the dispatcher                //let session best drive all the updates                $scope.$watch("data.Car.REFERENCE.LapTimeDelta.SESSIONBEST.Value",$scope.update);                sraDispatcher.onClick($scope,$element,$scope.onClick);            }        };    }]);    return self;});</code></pre>
        </article>
        <!-- index.html -->
        <!-- class files -->
      </div>
      <footer style="clear:both">
        Documentation generated by
        <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a>
        using
        <a href="https://github.com/allenhwkim/angular-jsdoc">Angular-JSDoc template</a>
      </footer>
    </div>
    <!--%= prettyJson %-->
    <script>
      prettyPrint();
      var lineNo = window.location.hash.match(/#line([0-9]+)$/);
      lineNo && document.querySelector("ol li:nth-child("+(lineNo[1])+")").scrollIntoView();
    </script>
  </body>
</html>